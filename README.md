# テキスト整形ツール — README

**現在のバージョン**: v1.0.0（2025-09-05）

本ツールは、社内の広報・販促物で使う「会期／会場／本文」テキストを、
ブラウザだけで安全・高速に整形するために作られました。ペースト→変換→コピーの
最短 3 ステップで、URL 保護、全角・半角の統一、表記ゆれの解消、会期の開始・終了日時の抽出などを行います。

---

## 1. 経緯（ダイジェスト）
- 既存の手作業整形に時間とバラつきが生じていたため、ルールをコード化。
- 変更容易性のため、**加工パイプライン（`rulesGlobal`）に小さな関数を追加**して拡張する設計に。
- 会期は独自パーサを実装し、**開始／終了日時**を自動抽出。終了日は「火曜は17:30、それ以外19:30」を既定とし、
  文末の「※最終日は午後4時閉場。」等があれば**その時刻を優先**する仕様にしています。

---

## 2. ビルド不要（静的 HTML）
- ファイルは 1 枚の `index.html`（本プロジェクトでは名称自由）だけで動作します。
- 依存関係なし。ローカルでも GitHub Pages でも動作します。

---

## 3. バージョニング方針
- **採用**: [SemVer 2.0.0](https://semver.org/lang/ja/) の記法に準拠（例: `v1.2.3`）。
- **更新ルール**:
  - **PATCH**: 互換性のある不具合修正（例: 既存ルールのバグ修正）。
  - **MINOR**: 後方互換のある機能追加（例: ルール追加・軽微な UI 改善）。
  - **MAJOR**: 互換性のない変更（例: 既存出力形式の破壊的変更）。

> HTML と README の **両方に同じバージョン**を記載してください。

---

## 4. 変更履歴（Changelog）

### v1.0.0 — 2025-09-05
- 初回の社内公開版。
- 主な全体ルール（抜粋）:
  - **URL 保護**: 変換前に URL を一時退避し、内部の全角英数・記号を半角化して復元。
  - **互換単位**: `㎝ (U+339D)`→`cm`、`㎖ (U+3396)`→`ml`。
  - **角括弧と波線**: `[]`→`［］`、`~`/`〜`→`～`。
  - **表記統一**:
    - `POPUP`→`POP UP`、`POPUPSHOP`→`POP UP SHOP`、`POPUPSTORE`→`POP UP STORE`
    - `是非`→`ぜひ`、`くださいませ`→`ください`、`お買い上げ/お買いあげ`→`お買上げ`
    - `致します`→`いたします`、`ラインナップ`→`ラインアップ`、`髙島屋`→`高島屋`
  - **半角/全角正規化**: 英数は半角、記号は原則全角（ただし英数連続語中の記号は半角）
    - 例: 括弧類 `()`→`（）`、`<>`→`〈〉`、`【】`→`〔〕`、`*`/`＊`→`※` など。
  - **TEL**: `TEL:`/`TEL：` は常に **`TEL：`（全角コロン）**。
  - **スペース/改行**: 連続スペースは 1 つに、3 行以上の連続改行は 2 行に圧縮。
  - **価格検出**: `000円`、`0,000円`、`00,000円`、`000,000円`、`0,000,000円` などを価格と認識し、
    行頭でない場合は **直前に全角スペース**を付加（例: `…は　1,980円`）。  
    ただし **`税込…円以上` は除外**。

- 会期パーサ（要点）:
  - `～`/`→` を **期間セパレータ**として扱う。
  - `開催中～` に対応（右側のみ解析）。
  - `・` 区切りの列挙、単日、範囲に対応。曜日・祝/振付与。
  - 終了時刻は既定の **19:30（火曜は 17:30）**。文末の `※…（午前/午後）h時m分` があればそれを優先。

---

## 5. バージョンの埋め込み（HTML への表示）

HTML 冒頭とヘッダーに **同一のバージョン番号**を表示します。既存ファイルに以下を追記してください。

### 5.1 `<head>` に追記
```html
<!-- Text Formatter v1.0.0 - 2025-09-05 -->
<meta name="app-version" content="v1.0.0">
```

### 5.2 CSS（既存の `<style>` に末尾追加）
```css
header { display:flex; align-items:center; justify-content:space-between; }
.ver-badge { font-size:10px; background:#3d3d3d; border:1px solid #565656; color:#eaeaea;
  border-radius:2px; padding:0 6px; line-height:18px; height:18px; white-space:nowrap; }
```

### 5.3 ヘッダー（`<header>` 内）
```html
<header>
  <h1>テキスト整形ツール（プレビュー）</h1>
  <span id="ver" class="ver-badge"></span>
</header>
```

### 5.4 スクリプト（既存 `<script>` 先頭付近に追加）
```html
<script>
  const APP_VERSION = "v1.0.0";
  const APP_BUILD   = "2025-09-05";
  document.addEventListener("DOMContentLoaded", () => {
    const el = document.getElementById("ver");
    if (el) el.textContent = `${APP_VERSION} (${APP_BUILD})`;
  });
</script>
```

> 既存の `header` に要素を 1 つ足すだけです。`display:flex` を付与しているので
> タイトルの右側に小さなバッジとしてバージョンが並びます。

---

## 6. バージョン更新の運用手順

1. **仕様変更/ルール追加**をコミット。
2. `README.md` の「現在のバージョン」を更新し、**Changelog に項目を追記**。
3. HTML 内の `APP_VERSION`/`APP_BUILD`、`<meta name="app-version">`、
   冒頭の HTML コメントのバージョン表記を更新。
4. プルリク作成 → レビュー → マージ。GitHub Pages を使う場合はデプロイ確認。
5. 社内告知（バージョン / 変更点 / 影響範囲 / 移行に必要な操作）。

---

## 7. 開発メモ（追加ルールの作り方）
- 文字変換・表記統一は **`rulesGlobal.push(function yourRule(s)Ellipsis)`** で追加します。
- **順序が重要**な場合（例: `POPUPSTORE`→`POPUP`）、**具体的なものを先**に並べます。
- URL を壊さないよう、**URL 保護（`urlProtect`）より後で URL を改変しない**こと。
- 「会場」など個別セクション専用ルールは、**UI コントローラ内**でセット名を分岐して適用。

---

## 8. ライセンス / 権利
社内利用限定。外部公開や二次配布を行わないでください。
